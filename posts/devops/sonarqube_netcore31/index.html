<!DOCTYPE html>
<html>
  <head>
    <title>[Security] 利用免費開源資安檢測軟體 SonarQube 檢測 .NET Core 程式碼</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/blog/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/blog/css/layouts/main.css"/>
<link rel="stylesheet" href="/blog/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/blog/css/plyr.css"/>
<link rel="stylesheet" href="/blog/css/flag-icon.min.css"/>


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600">


<link rel="stylesheet" href="/blog/fontawesome/css/all.min.css"/>




<meta property="og:title" content="[Security] 利用免費開源資安檢測軟體 SonarQube 檢測 .NET Core 程式碼" />
<meta property="og:description" content="弱點掃描時常使用 owasp top 10 作為報告， 然而 owasp 軟體一年要價不菲，委外掃一次也是非常貴， 使用免費的 SonarQube 將弱點掃描整合到 CI/CD 階段， 要交付前再花錢委外掃一次似乎是個折衷的作法，避免一次檢測出來的弱點過多改動過大。
SonarQube 分為兩個部分 SonarQube Server、Scanner (Client 端程式)。 Scanner 負責進行掃描並將結果上傳 Server， 而 Server 作為負責處理和儲存分析報告的 compute engine 會分析上傳的結果， 並提供 Web 使用者介面、搜尋功能，因此分析完成後就可以直接在 Web 上查看報告， Scanner 除了能夠在 locale 端使用，還能直接整合到 CI/CD Server 上進行程式碼品質掃描。 雖說可以拿 localhost 直接作為 Server 使用， 這裡還是紀錄如何在虛擬機器上實際安裝 SonarQube， 以後在實際機器上安裝就可以作為參考，
準備 Linux Server 硬體 個人使用或小規模的團隊在一台機器上安裝就足夠使用了， 如果需要架設提供大量服務的伺服器，官網也提供 Cluster 的安裝方式方便做 Loading Balance。
這裡紀錄在一台 Ubuntu 20.04 上架設。 關於 Linux 安裝過程在這裡不加贅述， 官方提到硬體有幾個注意事項，對現代的硬體來說其實都還好，比較要注意的是硬碟空間：
 RAM 至少要 2G；free RAM 至少要 1G (所以用 Windows server 就要準備大很多喔)。 上傳報告需要一定的空間，因次對硬碟的空間與效能有一定的要求，不夠的話容易太慢。 server side 不支援 32-bit 作業系統；但 Scanner 可以支援 32-bit systems。  安裝 OpenJDK 11 sudo apt update sudo apt upgrade sudo apt install openjdk-11-jdk # 確認 java 版本 java --version 然後在 ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tigernaxojr.github.io/blog/posts/devops/sonarqube_netcore31/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-22T11:11:00+08:00" />
<meta property="article:modified_time" content="2021-09-22T11:11:00+08:00" />



    
    
<meta name="description" content="[Security] 利用免費開源資安檢測軟體 SonarQube 檢測 .NET Core 程式碼" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/rainbow.min.css"/>
<link rel="stylesheet" href="/blog/css/layouts/single.css"/>
<link rel="stylesheet" href="/blog/css/navigators/sidebar.css">

<link rel="stylesheet" href="/blog/css/style.css"/>



    




</head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    












<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/blog">
      YuCheng&#39;s Site</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/blog/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/blog/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/database/">[DB] Database</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/database/sql-cte/" title="[SQL] CTE">[SQL] CTE</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/database/sql-merge/" title="[SQL] Merge">[SQL] Merge</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/database/sql-ranking/" title="[SQL] Ranking">[SQL] Ranking</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/linux/">[OS] Linux</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/linux/centos8-static-ip/" title="[CentOS] 設定網路靜態IP">[CentOS] 設定網路靜態IP</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/linux/ubuntu22-ssh/" title="[Ubuntu] SSH 連線">[Ubuntu] SSH 連線</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/linux/ubuntu204-static-ip/" title="[Ubuntu] 設定網路靜態IP">[Ubuntu] 設定網路靜態IP</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/web/">[Web] Web 相關</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/web/web-tool-eudc-frontforge/eudc/" title="[Web] FontForge 造難字">[Web] FontForge 造難字</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/web/security-get/" title="[Web] 敏感性 GET 參數">[Web] 敏感性 GET 參數</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/javascript/">[前端] Javascript</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/js-arr-func/" title="[JS] Array 常用方法">[JS] Array 常用方法</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/js-obj-func/" title="[JS] Object 常用方法">[JS] Object 常用方法</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/js-module/" title="[JS] 各種模組(module)">[JS] 各種模組(module)</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/js-hoisting/" title="[JS] 提升與暫時性死區">[JS] 提升與暫時性死區</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/js-async/" title="[JS] 非同步程式設計">[JS] 非同步程式設計</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/js-prototype/" title="[JS]原型繼承鏈模型">[JS]原型繼承鏈模型</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/code-copy-html-content/" title="[Code] 複製元件內的文字">[Code] 複製元件內的文字</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/diy-simple-router/" title="[DIY] 前端路由">[DIY] 前端路由</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/javascript/diy-http-proxy-middleware/" title="[DIY] 開發 proxy">[DIY] 開發 proxy</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/frontend-vue/">[前端] Vue</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/frontend-vue/vue-router_add_query/" title="[Router] Navigation Guard 加入查詢參數">[Router] Navigation Guard 加入查詢參數</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/frontend-vue/vue-ts-provide/" title="[TS] TS-Provide">[TS] TS-Provide</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/frontend-vue/vue-comp-yncheckbox/" title="[元件] CheckBox">[元件] CheckBox</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/frontend-vue/vue-comp-promise/" title="[元件] Promise 元件方法">[元件] Promise 元件方法</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/frontend-vue/vue-comp-wrapper/" title="[元件] Wrapper Component">[元件] Wrapper Component</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/frontend-vue/vue-comp-global/" title="[元件] 全域元件">[元件] 全域元件</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/dotnet/">[後端] .NET</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-webapi/" title="[.NET] .NET 6 Web API 專案">[.NET] .NET 6 Web API 專案</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/nuget/" title="[.NET] 製作 Nuget package">[.NET] 製作 Nuget package</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/secret/" title="[.NET] 開發階段專案敏感資料">[.NET] 開發階段專案敏感資料</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/snippet-json-dt/" title="[Snippet] DataTable轉Json">[Snippet] DataTable轉Json</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/snippet-json-operate/" title="[Snippet] JsonElement 操作">[Snippet] JsonElement 操作</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/deploy-ubuntu2004-nginx/ubuntu2004_nginx/" title="[部屬手動] Ubuntu Nginx">[部屬手動] Ubuntu Nginx</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/basic-async-controller/" title="[基礎] 非同步控制器">[基礎] 非同步控制器</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/dotnet/startup-auth/">[練習] 認證與授權</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-auth/auth_guild_1/" title="[驗證與授權] 驗證與授權">[驗證與授權] 驗證與授權</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-auth/auth_guild_2/" title="[驗證與授權] 驗證設定">[驗證與授權] 驗證設定</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-auth/auth_guild_3/" title="[驗證與授權] 驗證實例">[驗證與授權] 驗證實例</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-auth/auth_guild_4/" title="[驗證與授權] 授權設定">[驗證與授權] 授權設定</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-auth/auth_guild_memo/" title="[驗證與授權] 備註頁面">[驗證與授權] 備註頁面</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/dotnet/startup-signalr/">[練習] 即時聊天專案</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-signalr/guild_1_start/" title="[SignalR] 建立專案">[SignalR] 建立專案</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-signalr/guild_2_issue_token/" title="[SignalR] 後端 Token 授權">[SignalR] 後端 Token 授權</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-signalr/guild_4_front_end_login/" title="[SignalR] 前端登入頁面">[SignalR] 前端登入頁面</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/dotnet/startup-signalr/guild_3_validate_token/" title="[SignalR] 後端 Token 認證">[SignalR] 後端 Token 認證</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/software/">[系統] 軟體設計</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/software/arch-multi-layer/" title="[架構] 多層(layer)架構">[架構] 多層(layer)架構</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/software/arch-n-tier/" title="[架構] 多層(tier)架構">[架構] 多層(tier)架構</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/software/arch-clean-arch-review/" title="[架構] 無暇的程式碼">[架構] 無暇的程式碼</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/software/quality-nest/" title="[程式] 巢狀結構">[程式] 巢狀結構</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/container/">[維運] Container 容器</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/container/basic-resource/" title="[Basic] 學習資源">[Basic] 學習資源</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/container/docker-namespace/" title="[Basic] Namespace">[Basic] Namespace</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/container/docker-postgresql/" title="[Docker] Postgresql">[Docker] Postgresql</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/container/docker-command/" title="[Docker] 基礎指令">[Docker] 基礎指令</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/container/docker-install/" title="[Docker] 安裝">[Docker] 安裝</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/container/k8s-example-tnsnames.ora/" title="[K8s] 共享 tnsnames.ora">[K8s] 共享 tnsnames.ora</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/container/k8s-basc-install/" title="[K8S] 自架 K8S 腳本">[K8S] 自架 K8S 腳本</a></li>
  


      </ul>
    </li>
  

  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/blog/posts/devops/">[維運] DevOps</a>
      
      <ul class="active">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/devops/git-orphan-worktree/" title="[Git] CLI 專案 CI/CD Git 設定">[Git] CLI 專案 CI/CD Git 設定</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/blog/posts/devops/sonarqube_netcore31/" title="[Tips] SonarQube 檢測">[Tips] SonarQube 檢測</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/other/">[其他] Other</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/blog/posts/other/homeassistant/">[智能家居] Home Assistant</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/blog/posts/other/homeassistant/ha-install/" title="[安裝] 使用 Docker 安裝">[安裝] 使用 Docker 安裝</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/other/telegram-bot/" title="[Bot] Telegram Bot">[Bot] Telegram Bot</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/other/taiwania_login_oneclick/" title="[DIY] 一鍵登入台灣杉">[DIY] 一鍵登入台灣杉</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/other/linux-gdrive-cli/" title="[工具] Gdrive CLI / Linux">[工具] Gdrive CLI / Linux</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/other/vim-plugin-ycm/" title="[工具] Vim Plugin YCM">[工具] Vim Plugin YCM</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/blog/posts/other/auth-oauth2/" title="[授權] OAuth2.0">[授權] OAuth2.0</a></li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(/blog/images/default-hero.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/blog/images/default-avatar_hu6902af5411c8e2aeb5d4a7246d8a617a_6271_120x120_fit_box_3.png' alt="Author Image">
          <h5 class="author-name">Yu Cheng</h5>
          <p>Wednesday, September 22, 2021</p>
        </div>

        <div class="title">
          <h1>[Security] 利用免費開源資安檢測軟體 SonarQube 檢測 .NET Core 程式碼</h1>
        </div>
        
        <div class="post-content" id="post-content">
          <p>弱點掃描時常使用 owasp top 10 作為報告，
然而 owasp 軟體一年要價不菲，委外掃一次也是非常貴，
使用免費的 SonarQube 將弱點掃描整合到 CI/CD 階段，
要交付前再花錢委外掃一次似乎是個折衷的作法，避免一次檢測出來的弱點過多改動過大。</p>
<p>SonarQube 分為兩個部分 SonarQube Server、Scanner (Client 端程式)。
Scanner 負責進行掃描並將結果上傳 Server，
而 Server 作為負責處理和儲存分析報告的 compute engine 會分析上傳的結果，
並提供 Web 使用者介面、搜尋功能，因此分析完成後就可以直接在 Web 上查看報告，
Scanner 除了能夠在 locale 端使用，還能直接整合到 CI/CD Server 上進行程式碼品質掃描。
雖說可以拿 localhost 直接作為 Server 使用，
這裡還是紀錄如何在虛擬機器上實際安裝 SonarQube，
以後在實際機器上安裝就可以作為參考，</p>
<h1 id="準備-linux-server">準備 Linux Server</h1>
<h2 id="硬體">硬體</h2>
<p>個人使用或小規模的團隊在一台機器上安裝就足夠使用了，
如果需要架設提供大量服務的伺服器，官網也提供 Cluster 的安裝方式方便做 Loading Balance。</p>
<p>這裡紀錄在一台 Ubuntu 20.04 上架設。
關於 Linux 安裝過程在這裡不加贅述，
官方提到硬體有幾個注意事項，對現代的硬體來說其實都還好，比較要注意的是硬碟空間：</p>
<ul>
<li>RAM 至少要 2G；free RAM 至少要 1G (所以用 Windows server 就要準備大很多喔)。</li>
<li>上傳報告需要一定的空間，因次對硬碟的空間與效能有一定的要求，不夠的話容易太慢。</li>
<li>server side 不支援 32-bit 作業系統；但 Scanner 可以支援 32-bit systems。</li>
</ul>
<h2 id="安裝-openjdk-11">安裝 OpenJDK 11</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt upgrade
</span></span><span style="display:flex;"><span>sudo apt install openjdk-11-jdk
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 確認 java 版本</span>
</span></span><span style="display:flex;"><span>java --version
</span></span></code></pre></div><p>然後在 <code>.bashrc</code> 裡面把 Java 添加到 PATH 變數上。</p>
<h2 id="安裝-postgresql-13">安裝 PostgreSQL 13</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#添加 apt-key</span>
</span></span><span style="display:flex;"><span>wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;deb http://apt.postgresql.org/pub/repos/apt/ `lsb_release -cs`-pgdg main&#34;</span> |sudo tee  /etc/apt/sources.list.d/pgdg.list
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安裝資料庫</span>
</span></span><span style="display:flex;"><span>sudo apt install postgresql-13 postgresql-client-13
</span></span><span style="display:flex;"><span>systemctl status postgresql.service <span style="color:#75715e">#查看 postgresql 服務狀態</span>
</span></span></code></pre></div><p>設置密碼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> sudo <span style="color:#f92672">-</span>u postgres psql
</span></span><span style="display:flex;"><span><span style="color:#f92672">#</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> sonarqube; <span style="color:#75715e">-- 建立資料庫
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">#</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> sonarqube <span style="color:#66d9ef">with</span> <span style="color:#66d9ef">encrypted</span> password <span style="color:#e6db74">&#39;mypass&#39;</span>; <span style="color:#75715e">-- 建立資料庫使用者和密碼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">ROLE</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">#</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">database</span> sonarqube <span style="color:#66d9ef">to</span> sonarqube; <span style="color:#75715e">-- 設定資料庫權限
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">GRANT</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">#</span> EXIT;
</span></span></code></pre></div><p>如果資料庫和 SonarQube Server 不在同一台機器上，
必須透過網路連線則要設定監聽、白名單設定檔：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># /etc/postgresql/13/main/postgresql.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 監聽所有位址連線</span>
</span></span><span style="display:flex;"><span>listen_addresses <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或是只監聽特定 IP 的連線</span>
</span></span><span style="display:flex;"><span>listen_addresses <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;192.168.10.11&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># /etc/postgresql/13/main/pg_hba.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 所有連線都視為白名單</span>
</span></span><span style="display:flex;"><span>host all all 0.0.0.0/0 md5
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或是只將特定的 IP 加為白名單</span>
</span></span><span style="display:flex;"><span>host all all 10.10.10.0/24 md5
</span></span></code></pre></div><h2 id="調整-linux-限制">調整 Linux 限制</h2>
<p>SonarQube 對於 Linux 作為 Server 有下面的要求：</p>
<ul>
<li>vm.max_map_count &gt;= 524288</li>
<li>fs.file-max &gt;= 131072</li>
<li>SonarQube user 可開啟的 file descriptors &gt;= 131072</li>
<li>SonarQube user 可開啟的 threads &gt;= 8192</li>
</ul>
<p>首先查看 Ubuntu 20.04 的預設限制，發現只需要調整 vm.max_map_count 和 ulimit -n</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sysctl vm.max_map_count <span style="color:#75715e"># 65530</span>
</span></span><span style="display:flex;"><span>sysctl fs.file-max <span style="color:#75715e"># 9223372036854775807</span>
</span></span><span style="display:flex;"><span>ulimit -n <span style="color:#75715e"># 1024</span>
</span></span><span style="display:flex;"><span>ulimit -u <span style="color:#75715e">#15392</span>
</span></span></code></pre></div><p>進行調整，附上其他參數的調整方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo sysctl -w vm.max_map_count<span style="color:#f92672">=</span><span style="color:#ae81ff">524288</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sudo sysctl -w fs.file-max=131072</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ulimit -n 131072</span>
</span></span><span style="display:flex;"><span>ulimit -u <span style="color:#ae81ff">8192</span>
</span></span></code></pre></div><p>上面的調整都是只對使用者登入階段暫時發生作用，
因此另外新增 conf 文件為使用者 sonarqube 預設解除限制：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># /etc/sysctl.d/99-sonarqube.conf</span>
</span></span><span style="display:flex;"><span>sonarqube   -   nofile   <span style="color:#ae81ff">131072</span>
</span></span><span style="display:flex;"><span>sonarqube   -   nproc    <span style="color:#ae81ff">8192</span>
</span></span></code></pre></div><h2 id="安裝-sonarqube-server-901">安裝 SonarQube Server 9.0.1</h2>
<h3 id="下載-server-端程式">下載 Server 端程式</h3>
<p>先從<a href="https://www.sonarqube.org/downloads/">這裡</a>找到下載連結，
我下載的是 Community 最新版本。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 下載</span>
</span></span><span style="display:flex;"><span>wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.0.1.46107.zip
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 解壓縮</span>
</span></span><span style="display:flex;"><span>unzip sonarqube-9.0.1.46107.zip
</span></span></code></pre></div><h3 id="設置">設置</h3>
<p>修改檔案 <code>$SONARQUBE-HOME/conf/sonar.properties</code>，
設定 PostgreSQL 資料庫的連線，
使用者名稱為 sonarqube，密碼 mypass， 使用的資料庫 sonarqube</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 資料庫設置</span>
</span></span><span style="display:flex;"><span>sonar.jdbc.username<span style="color:#f92672">=</span>sonarqube
</span></span><span style="display:flex;"><span>sonar.jdbc.password<span style="color:#f92672">=</span>mypass
</span></span><span style="display:flex;"><span>sonar.jdbc.url<span style="color:#f92672">=</span>jdbc:postgresql://localhost/sonarqube
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 設置 Elasticsearch data 存放位址</span>
</span></span><span style="display:flex;"><span>sonar.path.data<span style="color:#f92672">=</span>/var/sonarqube/data
</span></span><span style="display:flex;"><span>sonar.path.temp<span style="color:#f92672">=</span>/var/sonarqube/temp
</span></span></code></pre></div><h3 id="設定密碼">設定密碼</h3>
<p>嘗試啟動 SonarQuebe Server</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/linux-x86-64/sonar.sh start
</span></span></code></pre></div><p>因為我是用連接埠轉送到虛擬機的9000，所以我打開的網址是 <code>http://127.0.0.1:8090</code>，
如果在本地機器上執行就是打開 <code>http://localhost:9000</code>，
開啟後一開始會看到 SonarQube is starting，
需要等待一下下就會出現登入畫面，
用 admin/admin 登入後會馬上要求重設密碼。</p>
<h3 id="設置開機啟動">設置開機啟動</h3>
<p>新增一個 service 檔案 <code>/etc/systemd/system/sonarqube.service</code></p>
<pre tabindex="0"><code>[Unit]
Description=SonarQube Server

[Service]
Type=simple
ExecStart=/bin/bash /pkg/sonarqube-9.0.1.46107/bin/linux-x86-64/sonar.sh start
ExecStop=/bin/bash /pkg/sonarqube-9.0.1.46107/bin/linux-x86-64/sonar.sh stop
ExecReload=/bin/bash /pkg/sonarqube-9.0.1.46107/bin/linux-x86-64/sonar.sh restart
Restart=always
LimitNOFILE=131072
LimitNPROC=8192

[Install]
WantedBy=multi-user.target
</code></pre><p>設置開機啟動</p>
<pre tabindex="0"><code>sudo systemctl enable sonarqube.service
</code></pre><h1 id="安裝-scanner">安裝 Scanner</h1>
<p>還沒有將 SonarQube 整合進 CI/CD 流程的需求之前，
可以採取的方式是開發進行到一個階段在程式開發機掃描程式碼，
再將結果上傳到 SonarQube Server，
因為我的 .NET Core 開發環境是 Visual Studio 2019，
所以 Scanner 安裝於 Windows 10 上。</p>
<blockquote>
<p>P.S.因為這裡的情境是在開發機上做分析，
因此前提假設機器上已經安裝相應的 dotnet sdk，
我是裝 3.1。</p>
</blockquote>
<h4 id="安裝-dotnet-sonarscanner">安裝 dotnet sonarscanner</h4>
<pre tabindex="0"><code>dotnet tool install --global dotnet-sonarscanner
</code></pre><h4 id="安裝-jre-11">安裝 JRE 11</h4>
<p>到 Java 網站上抓 JRE 11安裝，這裡一樣要確認系統環境變數新增，
新增 <code>JAVA_HOME</code> 系統變數，值為 <code>C:\Program Files\Java\jdk-11.0.12</code></p>
<h2 id="進行分析">進行分析</h2>
<p>從 SonarQube Web 介面新增一個專案，分析方式選擇 Locally：
<img src="./choose_analysis.jpg" alt="選擇分析方式"></p>
<p>建立一個分析專案，上面是專案名稱，
下面填入跟其他專案不重複的 project key (這裡我還是用專案名稱)。
<img src="./create_project.png" alt="建立Project"></p>
<p>設置一組 Token 提供 local 端分析完畢後可以上傳報告：
<img src="./provide_token.png" alt="設置 Token"></p>
<p>專案分析設置，設置 <code>.NET</code>、<code>.NET Core</code>，
<img src="./project_setting.png" alt="專案設置"></p>
<p>設置玩畢下面會自動出現程式碼，
第一個區塊是要求先安裝剛剛安裝過的工具 dotnet-sonarqube 所以不需要理會，
第二個區塊共有三行程式碼，
把它複製起來貼到檔案 <code>sonarqube.bat</code>，然後把檔案放在要分析的專案資料夾底下。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bat" data-lang="bat"><span style="display:flex;"><span>dotnet sonarscanner begin /k:<span style="color:#e6db74">&#34;EVT-api&#34;</span> /d:sonar.host.url=<span style="color:#e6db74">&#34;http://localhost:6080&#34;</span>  /d:sonar.login=<span style="color:#e6db74">&#34;05759efdbea31b9abe4e5cba171841d88f2dc689&#34;</span>
</span></span><span style="display:flex;"><span>dotnet build
</span></span><span style="display:flex;"><span>dotnet sonarscanner end /d:sonar.login=<span style="color:#e6db74">&#34;05759efdbea31b9abe4e5cba171841d88f2dc689&#34;</span>
</span></span></code></pre></div><p>最後打開小黑窗，切換到專案所在的工作目錄，執行這個 bat 檔案，
接個 scanner 就會對程式碼進行分析、將結果上傳 SonarQube Server。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bat" data-lang="bat"><span style="display:flex;"><span>sonarqube.bat
</span></span></code></pre></div><p>執行開始到完成大概長這樣：
<img src="./scanner_start.png" alt="掃描開始">
<img src="./scanner_finish.png" alt="掃描完成"></p>
<h2 id="檢視結果">檢視結果</h2>
<p>點選專案會呈現總覽頁面，就可以知道問題出在哪然後點選在意的看。
<img src="./project_overview.png" alt="project overview">
如果需要客製化的報表，
可以使用 API 抓取資料再將資料用自己的方式呈現，
在此暫不詳述。</p>
<h2 id="版本控制">版本控制</h2>
<p>再進行一次分析，會把新的程式碼有那些問題列出來，舊的程式碼有那些問題未改善</p>
<h2 id="不需要執行的事項">不需要執行的事項</h2>
<ul>
<li>Adding the JDBC Driver: 因為是使用 Postgresql，用內建的就好。</li>
</ul>
<h1 id="referecne">Referecne</h1>
<ul>
<li><a href="https://www.sonarqube.org/">SonarQube</a></li>
<li><a href="https://github.com/SonarSource/sonarqube">SonarQube GitHub</a></li>
</ul>

        </div>

        
        <div class="row pl-3 pr-3">
        
        <div class="col-md-6 share-buttons">
        
          </div>

        
        
          
            
          
          <div class="col-md-6 btn-improve-page">
             
               <a href="https://github.com/tigernaxoJr/blog/edit/main/content/posts/DevOps/sonarqube_netcore31/index.md" title="Improve this page" target="_blank" rel="noopener">
            
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        
        </div>



      
      <hr />
        







  





  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
    
    
  
  

  
  

  
  

  
  

  
  

  
  

  
  


<div class="row next-prev-navigator">
  
    <div class="col-md-6 previous-article">
      <a href="/blog/posts/devops/git-orphan-worktree/" title="[DIY] 利用 orphan branch 和 worktree 在同一 Git 儲存庫控管原始碼與靜態資源分支" class="btn btn-outline-info">
        <div><i class="fas fa-chevron-circle-left"></i> Prev</div>
        <div class="next-prev-text">[DIY] 利用 orphan branch 和 worktree 在同一 Git 儲存庫控管原始碼與靜態資源分支</div>
      </a>
    </div>
  
  
      
      
        
      
      <div class="col-md-6 next-article">
        <a href="/blog/posts/other/homeassistant/ha-install/" title="[HA] 準備系統環境" class="btn btn-outline-info">
          <div>Next <i class="fas fa-chevron-circle-right"></i></div>
          <div class="next-prev-text">[HA] 準備系統環境</div>
        </a>
      </div>
    
</div>

      <hr />

      
      
      
      

      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#硬體">硬體</a></li>
    <li><a href="#安裝-openjdk-11">安裝 OpenJDK 11</a></li>
    <li><a href="#安裝-postgresql-13">安裝 PostgreSQL 13</a></li>
    <li><a href="#調整-linux-限制">調整 Linux 限制</a></li>
    <li><a href="#安裝-sonarqube-server-901">安裝 SonarQube Server 9.0.1</a>
      <ul>
        <li><a href="#下載-server-端程式">下載 Server 端程式</a></li>
        <li><a href="#設置">設置</a></li>
        <li><a href="#設定密碼">設定密碼</a></li>
        <li><a href="#設置開機啟動">設置開機啟動</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#安裝-dotnet-sonarscanner">安裝 dotnet sonarscanner</a></li>
            <li><a href="#安裝-jre-11">安裝 JRE 11</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#進行分析">進行分析</a></li>
    <li><a href="#檢視結果">檢視結果</a></li>
    <li><a href="#版本控制">版本控制</a></li>
    <li><a href="#不需要執行的事項">不需要執行的事項</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    










  
    
  



  
  
    
  

  
  
    
  

  
  

  
  
    
    
      
    
  


  
  
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer id="footer" class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://tigernaxojr.github.io/blog/#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://tigernaxojr.github.io/blog/#skills">Skills</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://tigernaxojr.github.io/blog/#experiences">Experiences</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://tigernaxojr.github.io/blog/#education">Education</a>
                </li>
              
            
              
            
          </ul>
          
        </div>
        
        
        <div class="col-md-4 col-sm-12">
          <h5>Contact me:</h5>
          <ul>
            
              
                <li><a href=mailto:tigernaxo.co.cc@gmail.com target="_blank" rel="noopener">
                  <span><i class="fas fa-envelope"></i></span> <span>tigernaxo.co.cc@gmail.com</span>
                </a></li>
              
            
              
                <li><span><i class="fas fa-phone-alt"></i></span> <span>&#43;886919681059</span></li>
              
            
          </ul>
        </div>
        
        
        
          
          <div class="col-md-4 col-sm-12">
            <p>Stay up to date with email notification</p>
            
              <form method='post' action='https://blogtrottr.com'>
              <div class="form-group">
              <input type='email' class="form-control" name='btr_email' placeholder="Enter email"/><br />
              <input type='hidden' name='btr_url' value='https://tigernaxojr.github.io/blog/index.xml' />
              <input type='hidden' name='schedule_type' value='1' />
              <small id="emailHelp" class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small>
              <button type="submit" class="btn btn-info"> Submit </button>
              </div>
              </form>
            
          </div>
        
      </div>
    </div>
    
    
    <hr />
    <div class="container">
      <div class="row text-left">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hossainemruz/toha" target="_blank" rel="noopener">
            <img src="/blog/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">© 2022 Copyright.</div>
        <div class="col-md-4 text-right">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">Powered by
          <img
            src="/blog/images/hugo-logo.svg"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    
  </footer>


    <script type="text/javascript" src="/blog/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/blog/js/popper.min.js"></script>
<script type="text/javascript" src="/blog/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/blog/js/navbar.js"></script>
<script type="text/javascript" src="/blog/js/plyr.js"></script>
<script type="text/javascript" src="/blog/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
<script src="https://unpkg.com/highlightjs-badge@0.1.9/highlightjs-badge.min.js"></script>
<script src="/blog/js/single.js"></script>
<script>
  hljs.highlightAll();
  setTimeout( ()=>window.highlightJsBadge(), 1000); 
</script>









    
</body>
</html>
