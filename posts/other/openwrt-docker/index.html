<!doctype html><html><head><title>[OpenWrt] 在 linux 中使用 Docker 跑 OpenWrt</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href=/google-fonts/Mulish/mulish.css><link rel=stylesheet href=/fontawesome/css/all.min.css><meta property="og:title" content="[OpenWrt] 在 linux 中使用 Docker 跑 OpenWrt"><meta property="og:description" content="定義一個 Network，叫做 MYNAT，關閉 DHCP。
新增一部虛擬機，定義兩張網卡：
預設 NAT：用來模擬 ISP 裝置。(enp0s3) MYNAT：用來建構內網。(enp0s8) 開啟網卡 promisc ip link set enp0s3 promisc on ip link set enp0s8 promisc on ###. 建立 docker 網路 查詢路由所在網段、遮罩、閘道器。
ip route show dev enp0s3 結果：軟路由所在網段、遮罩為 10.0.2.0/24、閘道器 10.0.2.2。
default via 10.0.2.2 proto dhcp src 10.0.2.15 metric 1024 10.0.2.0/24 proto kernel scope link src 10.0.2.15 metric 1024 10.0.2.2 proto dhcp scope link src 10.0.2.15 metric 1024 192.73.141.230 via 10.0.2.2 proto dhcp src 10."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.tigernaxo.com/posts/other/openwrt-docker/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-19T08:00:00+08:00"><meta property="article:modified_time" content="2024-01-19T08:00:00+08:00"><meta name=description content="[OpenWrt] 在 linux 中使用 Docker 跑 OpenWrt"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span>
</button>
<a class=navbar-brand href=/>YuCheng's Site</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/database/>[DB] Database</a><ul><li><a href=/posts/database/sql-cte/ title="[SQL] CTE">[SQL] CTE</a></li><li><a href=/posts/database/sql-merge/ title="[SQL] Merge">[SQL] Merge</a></li><li><a href=/posts/database/sql-ranking/ title="[SQL] Ranking">[SQL] Ranking</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/linux/>[OS] Linux</a><ul><li><a href=/posts/linux/arch-install/ title="[Arch] 安裝(Virtualbox)">[Arch] 安裝(Virtualbox)</a></li><li><a href=/posts/linux/centos8-static-ip/ title="[CentOS] 設定網路靜態IP">[CentOS] 設定網路靜態IP</a></li><li><a href=/posts/linux/ubuntu22-ssh/ title="[Ubuntu] SSH 連線">[Ubuntu] SSH 連線</a></li><li><a href=/posts/linux/ubuntu204-static-ip/ title="[Ubuntu] 設定網路靜態IP">[Ubuntu] 設定網路靜態IP</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/secure/>[Secure] 安全性議題</a><ul><li><a href=/posts/secure/oauth2-01protocol/ title="[授權] OAuth 2.0 簡介">[授權] OAuth 2.0 簡介</a></li><li><a href=/posts/secure/oauth2-02grants/ title="[授權] OAuth 2.0 授權許可">[授權] OAuth 2.0 授權許可</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/web/>[Web] Web 相關</a><ul><li><a href=/posts/web/keycloak-docker-compose/ title="[Keycloak] docker 安裝">[Keycloak] docker 安裝</a></li><li><a href=/posts/web/web-tool-eudc-frontforge/eudc/ title="[Web] FontForge 造難字">[Web] FontForge 造難字</a></li><li><a href=/posts/web/web-api-design/ title="[Web] 敏感性 GET 參數">[Web] 敏感性 GET 參數</a></li><li><a href=/posts/web/security-get/ title="[Web] 敏感性 GET 參數">[Web] 敏感性 GET 參數</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/javascript/>[前端] Javascript</a><ul><li><a href=/posts/javascript/js-arr-func/ title="[JS] Array 常用方法">[JS] Array 常用方法</a></li><li><a href=/posts/javascript/js-obj-func/ title="[JS] Object 常用方法">[JS] Object 常用方法</a></li><li><a href=/posts/javascript/js-module/ title="[JS] 各種模組(module)">[JS] 各種模組(module)</a></li><li><a href=/posts/javascript/js-hoisting/ title="[JS] 提升與暫時性死區">[JS] 提升與暫時性死區</a></li><li><a href=/posts/javascript/js-async/ title="[JS] 非同步程式設計">[JS] 非同步程式設計</a></li><li><a href=/posts/javascript/js-prototype/ title=[JS]原型繼承鏈模型>[JS]原型繼承鏈模型</a></li><li><a href=/posts/javascript/code-roc-format/ title="[Code] 格式化民國年">[Code] 格式化民國年</a></li><li><a href=/posts/javascript/code-copy-html-content/ title="[Code] 複製元件內的文字">[Code] 複製元件內的文字</a></li><li><a href=/posts/javascript/diy-simple-router/ title="[DIY] 前端路由">[DIY] 前端路由</a></li><li><a href=/posts/javascript/diy-http-proxy-middleware/ title="[DIY] 開發 proxy">[DIY] 開發 proxy</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/typescript/>[前端] Typescript</a><ul><li><a href=/posts/typescript/ts-extend-global-obj/ title="[TS] 擴充標準內建物件">[TS] 擴充標準內建物件</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/frontend-vue/>[前端] Vue</a><ul><li><a href=/posts/frontend-vue/vue-router_add_query/ title="[Router] Navigation Guard 加入查詢參數">[Router] Navigation Guard 加入查詢參數</a></li><li><a href=/posts/frontend-vue/vue-ts-provide/ title="[TS] TS-Provide">[TS] TS-Provide</a></li><li><a href=/posts/frontend-vue/vue-comp-yncheckbox/ title="[元件] CheckBox">[元件] CheckBox</a></li><li><a href=/posts/frontend-vue/vue-comp-promise/ title="[元件] Promise 元件方法">[元件] Promise 元件方法</a></li><li><a href=/posts/frontend-vue/vue-comp-wrapper/ title="[元件] Transparent Wrapper">[元件] Transparent Wrapper</a></li><li><a href=/posts/frontend-vue/vue-ts-bug/ title="[元件] TypeScript 注意事項">[元件] TypeScript 注意事項</a></li><li><a href=/posts/frontend-vue/vue-comp-global/ title="[元件] 全域元件">[元件] 全域元件</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/dotnet/>[後端] .NET</a><ul><li><a href=/posts/dotnet/startup-webapi/ title="[.NET] .NET 6 Web API 專案">[.NET] .NET 6 Web API 專案</a></li><li><a href=/posts/dotnet/pdf-print/ title="[.NET] PDF 列印">[.NET] PDF 列印</a></li><li><a href=/posts/dotnet/webview2-single-file/ title="[.NET] WebView2 單檔部屬">[.NET] WebView2 單檔部屬</a></li><li><a href=/posts/dotnet/nuget/ title="[.NET] 製作 Nuget package">[.NET] 製作 Nuget package</a></li><li><a href=/posts/dotnet/secret/ title="[.NET] 開發階段專案敏感資料">[.NET] 開發階段專案敏感資料</a></li><li><a href=/posts/dotnet/snippet-json-dt/ title="[Snippet] DataTable轉Json">[Snippet] DataTable轉Json</a></li><li><a href=/posts/dotnet/snippet-json-operate/ title="[Snippet] JsonElement 操作">[Snippet] JsonElement 操作</a></li><li><a href=/posts/dotnet/deploy-ubuntu2004-nginx/ubuntu2004_nginx/ title="[部屬手動] Ubuntu Nginx">[部屬手動] Ubuntu Nginx</a></li><li><a href=/posts/dotnet/basic-async-controller/ title="[基礎] 非同步控制器">[基礎] 非同步控制器</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/dotnet/startup-auth/>[練習] 認證與授權</a><ul><li><a href=/posts/dotnet/startup-auth/auth_guild_1/ title="[驗證與授權] 驗證與授權">[驗證與授權] 驗證與授權</a></li><li><a href=/posts/dotnet/startup-auth/auth_guild_2/ title="[驗證與授權] 驗證設定">[驗證與授權] 驗證設定</a></li><li><a href=/posts/dotnet/startup-auth/auth_guild_3/ title="[驗證與授權] 驗證實例">[驗證與授權] 驗證實例</a></li><li><a href=/posts/dotnet/startup-auth/auth_guild_4/ title="[驗證與授權] 授權設定">[驗證與授權] 授權設定</a></li><li><a href=/posts/dotnet/startup-auth/auth_guild_memo/ title="[驗證與授權] 備註頁面">[驗證與授權] 備註頁面</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/dotnet/startup-signalr/>[練習] 即時聊天專案</a><ul><li><a href=/posts/dotnet/startup-signalr/guild_1_start/ title="[SignalR] 建立專案">[SignalR] 建立專案</a></li><li><a href=/posts/dotnet/startup-signalr/guild_2_issue_token/ title="[SignalR] 後端 Token 授權">[SignalR] 後端 Token 授權</a></li><li><a href=/posts/dotnet/startup-signalr/guild_4_front_end_login/ title="[SignalR] 前端登入頁面">[SignalR] 前端登入頁面</a></li><li><a href=/posts/dotnet/startup-signalr/guild_3_validate_token/ title="[SignalR] 後端 Token 認證">[SignalR] 後端 Token 認證</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/csharp/>[後端] csharp</a><ul><li><a href=/posts/csharp/async/ title="[Code] 處理民國年">[Code] 處理民國年</a></li><li><a href=/posts/csharp/cultureinfo/ title="[Code] 處理民國年">[Code] 處理民國年</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/software/>[系統] 軟體設計</a><ul><li><a href=/posts/software/arch-multi-layer/ title="[架構] 多層(layer)架構">[架構] 多層(layer)架構</a></li><li><a href=/posts/software/arch-n-tier/ title="[架構] 多層(tier)架構">[架構] 多層(tier)架構</a></li><li><a href=/posts/software/arch-clean-arch-review/ title="[架構] 無暇的程式碼">[架構] 無暇的程式碼</a></li><li><a href=/posts/software/quality-nest/ title="[程式] 巢狀結構">[程式] 巢狀結構</a></li><li><a href=/posts/software/pg-method-chaining/ title="[程設] 鏈式語法比較">[程設] 鏈式語法比較</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/container/>[維運] Container 容器</a><ul><li><a href=/posts/container/basic-resource/ title="[Basic] 學習資源">[Basic] 學習資源</a></li><li><a href=/posts/container/docker-command/ title="[Docker] 基礎指令">[Docker] 基礎指令</a></li><li><a href=/posts/container/docker-install/ title="[Docker] 安裝">[Docker] 安裝</a></li><li><a href=/posts/container/k8s-example-tnsnames.ora/ title="[K8s] 共享 tnsnames.ora">[K8s] 共享 tnsnames.ora</a></li><li><a href=/posts/container/k8s-basc-install/ title="[K8S] 自架 K8S 腳本">[K8S] 自架 K8S 腳本</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/devops/>[維運] DevOps</a><ul><li><a href=/posts/devops/git-orphan-worktree/ title="[Git] orphan branch/worktree">[Git] orphan branch/worktree</a></li><li><a href=/posts/devops/git-action-release-dotnet/ title="[Git] Release Action (Dotnet)">[Git] Release Action (Dotnet)</a></li><li><a href=/posts/devops/git-action-release-vue/ title="[Git] Release Action (Vue)">[Git] Release Action (Vue)</a></li><li><a href=/posts/devops/k8s-debian-kubeadm/ title="[K8S] K8S 安裝">[K8S] K8S 安裝</a></li><li><a href=/posts/devops/sonarqube_netcore31/ title="[SonarQube] 安裝與.NET 檢測">[SonarQube] 安裝與.NET 檢測</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/fhir/>[HIS] FHIR</a><ul><li><a href=/posts/fhir/fhir-smart-overview/ title="[SMART] Overview">[SMART] Overview</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/other/>[其他] Other</a><ul class=active><li><i class="fas fa-plus-circle"></i><a href=/posts/other/homeassistant/>[智能家居] Home Assistant</a><ul><li><a href=/posts/other/homeassistant/ha-install/ title="[安裝] Home Assistant 安裝">[安裝] Home Assistant 安裝</a></li></ul></li><li><a href=/posts/other/telegram-bot/ title="[Bot] Telegram Bot">[Bot] Telegram Bot</a></li><li><a href=/posts/other/taiwania_login_oneclick/ title="[DIY] 一鍵登入台灣杉">[DIY] 一鍵登入台灣杉</a></li><li><a href=/posts/other/hugo-toha-2023/ title="[Hugo] Toha Theme">[Hugo] Toha Theme</a></li><li><a class=active href=/posts/other/openwrt-docker/ title="[OpenWrt] Docker">[OpenWrt] Docker</a></li><li><a href=/posts/other/linux-gdrive-cli/ title="[工具] Gdrive CLI / Linux">[工具] Gdrive CLI / Linux</a></li><li><a href=/posts/other/tools-openapi-generator/ title="[工具] openapi generator">[工具] openapi generator</a></li><li><a href=/posts/other/vim-plugin-ycm/ title="[工具] Vim Plugin YCM">[工具] Vim Plugin YCM</a></li><li><a href=/posts/other/auth-oauth2/ title="[授權] OAuth2.0">[授權] OAuth2.0</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/default-avatar_hu6902af5411c8e2aeb5d4a7246d8a617a_6271_120x120_fit_box_3.png alt="Author Image"><h5 class=author-name>Yu Cheng</h5><p>Friday, January 19, 2024</p></div><div class=title><h1>[OpenWrt] 在 linux 中使用 Docker 跑 OpenWrt</h1></div><div class=post-content id=post-content><p>定義一個 Network，叫做 MYNAT，關閉 DHCP。</p><p>新增一部虛擬機，定義兩張網卡：</p><ol><li>預設 NAT：用來模擬 ISP 裝置。(enp0s3)</li><li>MYNAT：用來建構內網。(enp0s8)</li></ol><h3 id=開啟網卡-promisc>開啟網卡 promisc</h3><pre tabindex=0><code>ip link set enp0s3 promisc on 
ip link set enp0s8 promisc on 
</code></pre><p>###. 建立 docker 網路
查詢路由所在網段、遮罩、閘道器。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip route show dev enp0s3
</span></span></code></pre></div><p>結果：軟路由所在網段、遮罩為 <code>10.0.2.0/24</code>、閘道器 <code>10.0.2.2</code>。</p><pre tabindex=0><code>default via 10.0.2.2 proto dhcp src 10.0.2.15 metric 1024
10.0.2.0/24 proto kernel scope link src 10.0.2.15 metric 1024
10.0.2.2 proto dhcp scope link src 10.0.2.15 metric 1024
192.73.141.230 via 10.0.2.2 proto dhcp src 10.0.2.15 metric 1024
192.73.144.230 via 10.0.2.2 proto dhcp src 10.0.2.15 metric 1024
</code></pre><p>創建 docker 網路</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>docker network rm openwrt-wan
</span></span><span style=display:flex><span>docker network create -d macvlan <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --subnet<span style=color:#f92672>=</span>10.0.2.0/24 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --gateway<span style=color:#f92672>=</span>10.0.2.2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -o parent<span style=color:#f92672>=</span>enp0s3 openwrt-wan
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker network rm openwrt-lan
</span></span><span style=display:flex><span>docker network create -d macvlan <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --subnet<span style=color:#f92672>=</span>10.0.3.0/24 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --gateway<span style=color:#f92672>=</span>10.0.3.254 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -o parent<span style=color:#f92672>=</span>enp0s8 openwrt-lan
</span></span></code></pre></div><h3 id=製作-openwrt-容器>製作 OpenWrt 容器</h3><p><code>docker-compose.yml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>openwrt</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>zzsrv/openwrt:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>openwrt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privileged</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./network:/etc/config/network</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>openwrt-wan</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>openwrt-lan</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: <span style=color:#ae81ff>/sbin/init</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>openwrt-wan</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>openwrt-lan</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>啟動</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d <span style=color:#f92672>&amp;&amp;</span> docker-compose logs -f
</span></span></code></pre></div><p>設定容器的網路</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it openwrt bash
</span></span></code></pre></div><p><code>/etc/config/network</code> 改成這樣：</p><pre tabindex=0><code>config interface &#39;loopback&#39;
        option proto &#39;static&#39;
        option ipaddr &#39;127.0.0.1&#39;
        option netmask &#39;255.0.0.0&#39;
        option device &#39;lo&#39;

config globals &#39;globals&#39;
        option packet_steering &#39;1&#39;

config interface &#39;lan&#39;
        option proto &#39;static&#39;
        option ipaddr &#39;10.0.3.254&#39;
        option netmask &#39;255.255.255.0&#39;
        option device &#39;br-lan&#39;

config interface &#39;wan&#39;
        option proto &#39;dhcp&#39;
        option netmask &#39;255.255.255.0&#39;
        option device &#39;br-wan&#39;

config interface &#39;utun&#39;
        option proto &#39;none&#39;
        option ifname &#39;utun&#39;
        option device &#39;utun&#39;

config device
        option name &#39;br-lan&#39;
        option type &#39;bridge&#39;
        list ports &#39;eth1&#39;

config device
        option name &#39;br-wan&#39;
        option type &#39;bridge&#39;
        list ports &#39;eth0&#39;
</code></pre><p>重啟網路</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/etc/init.d/network restart
</span></span></code></pre></div><h3 id=openwrt-設定>openwrt 設定</h3><p>目前 openwrt 和路由主機處於同一個 NAT 下了，可以使用剛剛設定給 openwrt 的 IP <code>http://10.0.2.3</code> 進入控制面板，如果是用 virtualbox 就自行使用連接埠轉送。</p><ul><li>使用者：<code>root</code></li><li>密碼：<code>password</code></li></ul><p>取消 lan 的 DHCP：</p><ul><li><code>Network</code> -> <code>Interfaces</code> 點選 lan 項目的 <code>Edit</code></li><li><code>DHCP Server</code> -> <code>General Setup</code> -> 確認勾選 <code>Ignore interface</code></li></ul><h3 id=host-設定>host 設定</h3><p>主機無法直接透過 ip 訪問 macvlan 底下的 openwrt，需要額外設置一個 route：
這裡使用腳本比較清楚，方便修改：<code>route.sh</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>device<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;enp0s8&#34;</span>
</span></span><span style=display:flex><span>macvlan<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mac30&#34;</span>
</span></span><span style=display:flex><span>target<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;10.0.3.254&#34;</span>
</span></span><span style=display:flex><span>macvlan_ip<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;10.0.3.253&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip link add link <span style=color:#e6db74>${</span>device<span style=color:#e6db74>}</span> <span style=color:#e6db74>${</span>macvlan<span style=color:#e6db74>}</span> type macvlan mode bridge
</span></span><span style=display:flex><span>ip addr add <span style=color:#e6db74>${</span>macvlan_ip<span style=color:#e6db74>}</span>/24 brd + dev <span style=color:#e6db74>${</span>macvlan<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>ip link set <span style=color:#e6db74>${</span>macvlan<span style=color:#e6db74>}</span> up
</span></span><span style=display:flex><span><span style=color:#75715e># let host automatically use macvlan when communicating with target</span>
</span></span><span style=display:flex><span>ip route add <span style=color:#e6db74>${</span>target<span style=color:#e6db74>}</span> dev <span style=color:#e6db74>${</span>macvlan<span style=color:#e6db74>}</span>
</span></span></code></pre></div><p>執行</p><pre tabindex=0><code>chmod a+x ./route.sh
./route.sh
</code></pre><p>接下來主機就能使用內網 ip ping 到 openwrt</p><h2 id=reference>Reference</h2><ul><li><a href=https://mlapp.cn/376.html>在Docker 中运行 OpenWrt 旁路网关</a></li><li><a href=https://hub.docker.com/r/zzsrv/openwrt>DockerHub-zzsrv/openwrt</a></li><li><a href=https://blog.oddbit.com/post/2018-03-12-using-docker-macvlan-networks/>Using Docker macvlan networks</a></li></ul></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/tigernaxoJr/blog/edit/main/content/posts/other/openwrt-docker.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/other/hugo-toha-2023/ title="[Hugo] Toha Theme 10分鐘快速建構" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>[Hugo] Toha Theme 10分鐘快速建構</div></a></div><div class="col-md-6 next-article"><a href=/posts/other/linux-gdrive-cli/ title="[Tools] 在 linux 中使用 google drive cli" class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>[Tools] 在 linux 中使用 google drive cli</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#開啟網卡-promisc>開啟網卡 promisc</a></li><li><a href=#製作-openwrt-容器>製作 OpenWrt 容器</a></li><li><a href=#openwrt-設定>openwrt 設定</a></li><li><a href=#host-設定>host 設定</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://blog.tigernaxo.com#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://blog.tigernaxo.com#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://blog.tigernaxo.com#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://blog.tigernaxo.com#education>Education</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:tigernaxo.co.cc@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>tigernaxo.co.cc@gmail.com</span></a></li><li><span><i class="fas fa-phone-alt"></i></span> <span>+886919681059</span></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form method=post action=https://blogtrottr.com><div class=form-group><input type=email class=form-control name=btr_email placeholder="Enter email"><br><input type=hidden name=btr_url value=https://blog.tigernaxo.comindex.xml>
<input type=hidden name=schedule_type value=1>
<small id=emailHelp class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small>
<button type=submit class="btn btn-info"> Submit</button></div></form></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2022 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>